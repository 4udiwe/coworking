openapi: 3.0.3

info:
  title: Coworking Booking System ‚Äì Public API
  version: 1.0.0
  description: >
    –ü—É–±–ª–∏—á–Ω–æ–µ REST API —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Å—Ç –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å–∫–æ–º –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–µ.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–±–∏–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (Flutter) –∏ –≤–µ–±-–ø–∞–Ω–µ–ª—å—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
    –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ API Gateway.

servers:
  - url: https://api.coworking.local

tags:
  - name: Auth
  - name: Users
  - name: Coworkings
  - name: Places
  - name: Bookings
  - name: Analytics
  - name: Admin

paths:
  ##################
  # üîê AUTH SERVICE
  ##################

  /auth/register:
    post:
      tags: [Auth]
      summary: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
        "409":
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

  /auth/login:
    post:
      tags: [Auth]
      summary: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: JWT —Ç–æ–∫–µ–Ω—ã
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
        "401":
          description: –ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

  /auth/refresh:
    post:
      tags: [Auth]
      summary: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access/refresh —Ç–æ–∫–µ–Ω–æ–≤
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
      responses:
        "200":
          description: –ù–æ–≤–∞—è –ø–∞—Ä–∞ —Ç–æ–∫–µ–Ω–æ–≤
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthTokens"
        "401":
          description: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π refresh —Ç–æ–∫–µ–Ω

  /auth/logout:
    post:
      tags: [Auth]
      summary: –í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è refresh —Ç–æ–∫–µ–Ω–∞)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
      responses:
        "204":
          description: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω

  /users/me:
    get:
      tags: [Users]
      summary: –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      security:
        - bearerAuth: []
      responses:
        "200":
          description: –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          description: –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

  /users/sessions/active:
    get:
      tags: [Users]
      summary: –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      security:
        - bearerAuth: []
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UserSession"

  /users/sessions/all:
    get:
      tags: [Users]
      summary: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      security:
        - bearerAuth: []
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UserSession"

  /users/sessions/revoke:
    post:
      tags: [Users]
      summary: –û—Ç–æ–∑–≤–∞—Ç—å (—Ä–∞–∑–ª–æ–≥–∏–Ω–∏—Ç—å) —Å–µ—Å—Å–∏—é –ø–æ ID
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                session_id:
                  type: string
                  format: uuid
      responses:
        "200":
          description: –°–µ—Å—Å–∏—è –æ—Ç–æ–∑–≤–∞–Ω–∞

  ##################
  # üè¢ COWORKINGS
  ##################

  /coworkings:
    get:
      tags: [Coworkings]
      summary: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–æ–≤
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–æ–≤
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Coworking"

  /coworkings/{coworking_id}:
    get:
      tags: [Coworkings]
      summary: –ü–æ–ª—É—á–∏—Ç—å –∫–æ–≤–æ—Ä–∫–∏–Ω–≥ –ø–æ ID
      parameters:
        - in: path
          name: coworking_id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ö–æ–≤–æ—Ä–∫–∏–Ω–≥
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Coworking"

  /coworkings/{coworking_id}/places:
    get:
      tags: [Places]
      summary: –ü–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–∞ –≤ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–µ
      parameters:
        - in: path
          name: coworking_id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –º–µ—Å—Ç
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Place"

  ##################
  # üìÖ BOOKINGS
  ##################

  /bookings:
    post:
      tags: [Bookings]
      summary: –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBookingRequest"
      responses:
        "201":
          description: –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Booking"

    get:
      tags: [Bookings]
      summary: –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      security:
        - bearerAuth: []
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Booking"

  /bookings/{booking_id}:
    get:
      tags: [Bookings]
      summary: –ü–æ–ª—É—á–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ ID
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: booking_id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Booking"

  /bookings/{booking_id}/cancel:
    post:
      tags: [Bookings]
      summary: –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: booking_id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ

  ##################
  # üìä ANALYTICS
  ##################

  /analytics/usage:
    get:
      tags: [Analytics]
      summary: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–∞
      security:
        - bearerAuth: []
      responses:
        "200":
          description: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UsageStats"

  ##################
  # üõ† ADMIN
  ##################

  /admin/coworkings:
    get:
      tags: [Admin]
      summary: –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–æ–≤ (–∞–¥–º–∏–Ω)
      description: –í–∫–ª—é—á–∞—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–∏
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–æ–≤
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Coworking"

    post:
      tags: [Admin]
      summary: –°–æ–∑–¥–∞—Ç—å –∫–æ–≤–æ—Ä–∫–∏–Ω–≥
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCoworkingRequest"
      responses:
        "201":
          description: –ö–æ–≤–æ—Ä–∫–∏–Ω–≥ —Å–æ–∑–¥–∞–Ω
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Coworking"
  /admin/coworkings/{coworking_id}:
    put:
      tags: [Admin]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥–∞
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: coworking_id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateCoworkingRequest"
      responses:
        "200":
          description: –ö–æ–≤–æ—Ä–∫–∏–Ω–≥ –æ–±–Ω–æ–≤–ª—ë–Ω

    delete:
      tags: [Admin]
      summary: –£–¥–∞–ª–∏—Ç—å (–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å) –∫–æ–≤–æ—Ä–∫–∏–Ω–≥
      description: –§–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è, –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: coworking_id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "204":
          description: –ö–æ–≤–æ—Ä–∫–∏–Ω–≥ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
  /admin/coworkings/{coworking_id}/places:
    post:
      tags: [Admin]
      summary: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ –≤ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: coworking_id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePlaceRequest"
      responses:
        "201":
          description: –ú–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–æ
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Place"
  /admin/places/{place_id}:
    put:
      tags: [Admin]
      summary: –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Å—Ç–∞
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: place_id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePlaceRequest"
      responses:
        "200":
          description: –ú–µ—Å—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ

    delete:
      tags: [Admin]
      summary: –£–¥–∞–ª–∏—Ç—å (–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å) –º–µ—Å—Ç–æ
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: place_id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "204":
          description: –ú–µ—Å—Ç–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ
  /admin/bookings:
    get:
      tags: [Admin]
      summary: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      description: –° –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–µ –∏ –∫–æ–≤–æ—Ä–∫–∏–Ω–≥—É
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: coworking_id
          schema: { type: string, format: uuid }
        - in: query
          name: date
          schema: { type: string, format: date }
      responses:
        "200":
          description: –°–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Booking"
  /admin/bookings/{booking_id}/cancel:
    post:
      tags: [Admin]
      summary: –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: booking_id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        "200":
          description: –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
  /admin/analytics/usage:
    get:
      tags: [Admin]
      summary: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: coworking_id
          schema: { type: string, format: uuid }
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
      responses:
        "200":
          description: –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UsageStats"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    RefreshTokenRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

    AuthTokens:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        expiresIn:
          type: integer
          example: 900

    RegisterRequest:
      type: object
      required: [email, password, name, role_code]
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
        roleCode:
          type: string
          enum: [student, teacher, admin]

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [student, teacher, admin]

    Coworking:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        address:
          type: string

    CreateCoworkingRequest:
      type: object
      required: [name, address]
      properties:
        name:
          type: string
        address:
          type: string

    Place:
      type: object
      properties:
        id:
          type: string
          format: uuid
        label:
          type: string
        type:
          type: string
        is_available:
          type: boolean

    Booking:
      type: object
      properties:
        id:
          type: string
          format: uuid
        place_id:
          type: string
          format: uuid
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time
        status:
          type: string

    CreateBookingRequest:
      type: object
      required: [place_id, start_time, end_time]
      properties:
        place_id:
          type: string
          format: uuid
        start_time:
          type: string
          format: date-time
        end_time:
          type: string
          format: date-time

    UsageStats:
      type: object
      properties:
        peak_hours:
          type: array
          items:
            type: integer
        total_bookings:
          type: integer

    UpdateCoworkingRequest:
      type: object
      properties:
        name: { type: string }
        address: { type: string }

    CreatePlaceRequest:
      type: object
      required: [label, type]
      properties:
        label: { type: string }
        type: { type: string }

    UpdatePlaceRequest:
      type: object
      properties:
        label: { type: string }
        type: { type: string }
        is_available: { type: boolean }

    UserSession:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        user_agent:
          type: string
        device:
          type: string
        revoked:
          type: boolean
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
        ipAddress:
          type: string
        lastUsedAt:
          type: string
          format: date-time
